import{r as n,T as S,f as k,I as x,N as v,A as K,h as l,t as b,u,b as i,x as $,C as A,w as N,p as h,q as C,o as c,d as E}from"./app-BmMnv7Hf.js";import{_ as M}from"./InputError-CqlclkzZ.js";import{_ as T}from"./Button-BWK-thSE.js";import B from"./WaitForKey-B88pVrrY.js";import{b as F,s as W}from"./index-DMlPNJkt.js";const D={key:0},I={key:1},O={__name:"WebauthnLogin",props:{publicKey:Object,remember:Boolean},setup(g){const r=g,m=n(!0),s=n(""),a=n(!1),o=S({});k(()=>r.publicKey,t=>{s.value="",d(t)}),x(()=>{F()||(m.value=!1,s.value=v()),r.publicKey&&d(r.publicKey)});const _=(t,e)=>{switch(t){case"InvalidStateError":return h("Unexpected error on login.");case"NotAllowedError":return h("The operation either timed out or was not allowed.");default:return e}},p=()=>{s.value="",C.reload({only:["publicKey"]})},f=()=>{a.value=!1},d=t=>{a.value=!0,K().then(()=>W(t)).then(e=>w(e)).catch(e=>{s.value=_(e.name,e.message)})},w=t=>{o.transform(()=>({...t,remember:r.remember?"on":""})).post(route("webauthn.auth"),{preserveScroll:!0,preserveState:!0,onSuccess:()=>f(),onError:e=>{s.value=e.message??e.data.errors[0],f()}})};return(t,e)=>(c(),l("div",null,[m.value?(c(),l("div",I,[i(B,{"error-message":s.value,form:u(o),onRetry:e[0]||(e[0]=y=>p())},null,8,["error-message","form"]),i(M,{message:u(o).errors.data,class:"mt-2"},null,8,["message"]),$(i(T,{class:"ms-2",onClick:e[1]||(e[1]=y=>p())},{default:N(()=>[E(b(t.$t("Retry")),1)]),_:1},512),[[A,!a.value]])])):(c(),l("div",D,b(u(v)()),1))]))}};export{O as default};

import{r as p,T as M,s as R,I as U,N as x,A as E,c as F,w as i,p as $,o as r,d as y,t as a,h as n,u as v,b as l,F as T,k as D,a as s,l as I}from"./app-BmMnv7Hf.js";import{_ as W}from"./ActionSection-BsM9aqa2.js";import{_ as b}from"./SecondaryButton-3_x4XnxO.js";import{_ as S}from"./ConfirmsPassword-Dfy3Z1Op.js";import{_ as V}from"./Button-BWK-thSE.js";import j from"./RegisterKey-CVDfOj--.js";import L from"./DeleteKeyModal-DLmXvoNu.js";import O from"./UpdateKey-DcMrNiLN.js";import{b as q,a as z}from"./index-DMlPNJkt.js";import"./SectionTitle-f8TQ5xLi.js";import"./PrettyButton-DJ97II5T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogModal-BdRnJ9VP.js";import"./Modal-COqoaAX8.js";import"./Input-CLHvIp3o.js";import"./InputError-CqlclkzZ.js";import"./Label-DWTE4-tY.js";import"./WaitForKey-B88pVrrY.js";import"./ConfirmationModal-Dcz2uZEg.js";import"./DangerButton-OSGRtkYA.js";const G={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},H={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},J={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},P={key:3},Q={key:4},X={key:5},Y={key:6,class:"mt-5 space-y-6"},Z={key:0,class:"dark:text-gray-400"},ee={class:"ms-3 w-48"},te={class:"text-sm text-gray-600 dark:text-gray-400"},se={class:"text-xs text-gray-500"},ae={class:"ms-3 text-sm"},re={class:"mt-5 flex items-center"},Se={__name:"WebauthnKeys",props:{webauthnKeys:Array,publicKey:Object},setup(f){const g=f,k=p(!0),d=p(""),c=p(!1),m=M({name:""}),h=p(null),u=p(null),C=R(()=>u.value>0?g.webauthnKeys.find(t=>t.id===u.value).name:"");U(()=>{q()||(k.value=!1,d.value=x()),g.publicKey&&(_(),E().then(()=>w(g.publicKey)))});const K=(t,e)=>{switch(t){case"InvalidStateError":return $("This key is already registered. Itâ€™s not necessary to register it again.");case"NotAllowedError":return $("The operation either timed out or was not allowed.");default:return e}},_=()=>{d.value="",c.value=!0},B=()=>{d.value="",m.clearErrors()},w=t=>{z(t).then(e=>N(e)).catch(e=>{d.value=K(e.name,e.message)})},N=t=>{m.transform(e=>({...e,...t})).post(route("webauthn.store"),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{c.value=!1,m.reset()},onError:e=>{d.value=e.email??e.data.errors.webauthn}})};return(t,e)=>(r(),F(W,null,{title:i(()=>[y(a(t.$t("Security keys")),1)]),description:i(()=>[y(a(t.$t("Add additional security to your account using a security key.")),1)]),content:i(()=>[u.value>0?(r(),n("h3",G,a(t.$t("Update a key.")),1)):c.value?(r(),n("h3",J,a(t.$t("Register a new key.")),1)):(r(),n("h3",H,a(t.$t("Use a security key (Webauthn, or FIDO) to increase your account security.")),1)),k.value?c.value?(r(),n("div",Q,[l(j,{"error-message":d.value,form:v(m),name:v(m).name,"onUpdate:name":e[0]||(e[0]=o=>v(m).name=o),onStart:B,onStop:e[1]||(e[1]=o=>c.value=!1),onRegister:w},null,8,["error-message","form","name"])])):u.value>0?(r(),n("div",X,[l(O,{keyid:u.value,"name-update":C.value,onClose:e[2]||(e[2]=o=>u.value=null)},null,8,["keyid","name-update"])])):(r(),n("div",Y,[f.webauthnKeys.length===0?(r(),n("div",Z,a(t.$t("No keys registered yet")),1)):(r(!0),n(T,{key:1},D(f.webauthnKeys,o=>(r(),n("div",{key:o.id,class:"mb-2 flex items-center"},[e[4]||(e[4]=s("div",{class:"text-gray-500"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",stroke:"currentColor",class:"h-8 w-8",viewBox:"-50 0 700 600"},[s("g",{transform:"matrix(42.857142857142854,0,0,42.857142857142854,0,0)"},[s("g",null,[s("polyline",{points:"5.62 7.38 11.5 1.5 13.5 3.5"}),s("line",{x1:"9.25",y1:"3.75",x2:"11",y2:"5.5"}),s("circle",{cx:"3.5",cy:"9.5",r:"3"})])])])],-1)),s("div",ee,[s("div",te,a(o.name),1),s("div",se,[s("span",null,a(t.$t("Last active :date",{date:o.last_active})),1)])]),s("div",ae,[l(b,{class:"pointer text-indigo-400 hover:text-indigo-600",href:"",onClick:I(A=>u.value=o.id,["prevent"])},{default:i(()=>[y(a(t.$t("Update")),1)]),_:2},1032,["onClick"]),l(S,{onConfirmed:A=>h.value=o.id},{default:i(()=>[l(b,{class:"pointer ms-2 text-indigo-400 hover:text-indigo-600",href:""},{default:i(()=>[y(a(t.$t("Delete")),1)]),_:1})]),_:2},1032,["onConfirmed"])])]))),128)),s("div",re,[l(S,{onConfirmed:_},{default:i(()=>[l(V,{type:"button"},{default:i(()=>[y(a(t.$t("Register a new key")),1)]),_:1})]),_:1})])])):(r(),n("div",P,a(v(x)()),1)),l(L,{keyid:h.value,onClose:e[3]||(e[3]=o=>h.value=null)},null,8,["keyid"])]),_:1}))}};export{Se as default};

import{r as v,T as E,s as H,Q as M,f as N,c as h,w as a,o as t,d as c,t as o,h as s,a as n,j as l,b as i,u as x,B as Q,F as Y,k as j,n as k,q as S}from"./app-BmMnv7Hf.js";import{_ as D}from"./ActionSection-BsM9aqa2.js";import{_ as A}from"./Button-BWK-thSE.js";import{_ as p}from"./ConfirmsPassword-Dfy3Z1Op.js";import{_ as P}from"./DangerButton-OSGRtkYA.js";import{_ as z}from"./Input-CLHvIp3o.js";import{_ as O}from"./InputError-CqlclkzZ.js";import{_ as U}from"./Label-DWTE4-tY.js";import{_ as $}from"./SecondaryButton-3_x4XnxO.js";import"./SectionTitle-f8TQ5xLi.js";import"./PrettyButton-DJ97II5T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogModal-BdRnJ9VP.js";import"./Modal-COqoaAX8.js";const W={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},G={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},I={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},J={class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},X={key:3},Z={key:0},ee={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},te={key:0,class:"font-semibold"},oe={key:1},ae=["innerHTML"],se={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},re={class:"font-semibold"},ne=["innerHTML"],le={key:1,class:"mt-4"},ie={key:1},ce={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ue={class:"font-semibold"},de={class:"mt-4 grid max-w-xl gap-1 rounded-lg bg-gray-100 px-4 py-4 font-mono text-sm dark:bg-gray-950"},me={class:"mt-5"},fe={key:0},ve={key:1},Ae={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(B){const R=B,u=v(!1),r=v(!1),d=v(!1),_=v(null),g=v(null),y=v([]),m=E({code:""}),f=H(()=>{var e;return!u.value&&((e=M().props.auth.user)==null?void 0:e.two_factor_enabled)});N(f,()=>{f.value||(m.reset(),m.clearErrors())});const V=()=>{u.value=!0,S.post(route("two-factor.enable"),{},{headers:{accept:"application/json"},preserveScroll:!0,onSuccess:()=>Promise.all([K(),q(),b()]),onFinish:()=>{u.value=!1,r.value=R.requiresConfirmation}})},K=()=>axios.get(route("two-factor.qr-code")).then(e=>{_.value=e.data.svg}),q=()=>axios.get(route("two-factor.secret-key")).then(e=>{g.value=e.data.secretKey}),b=()=>axios.get(route("two-factor.recovery-codes")).then(e=>{y.value=e.data}),C=()=>{m.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{r.value=!1,_.value=null,g.value=null}})},L=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>b())},T=()=>{d.value=!0,S.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{d.value=!1,r.value=!1}})};return(e,F)=>(t(),h(D,null,{title:a(()=>[c(o(e.$t("Two Factor Authentication")),1)]),description:a(()=>[c(o(e.$t("Add additional security to your account using two factor authentication.")),1)]),content:a(()=>[f.value&&!r.value?(t(),s("h3",W,o(e.$t("You have enabled two factor authentication.")),1)):f.value&&r.value?(t(),s("h3",G,o(e.$t("Finish enabling two factor authentication.")),1)):(t(),s("h3",I,o(e.$t("You have not enabled two factor authentication.")),1)),n("div",J,[n("p",null,o(e.$t("When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone’s Authenticator application.")),1)]),f.value?(t(),s("div",X,[_.value?(t(),s("div",Z,[n("div",ee,[r.value?(t(),s("p",te,o(e.$t("To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code.")),1)):(t(),s("p",oe,o(e.$t("Two factor authentication is now enabled. Scan the following QR code using your phone’s authenticator application or enter the setup key.")),1))]),n("div",{class:"mt-4",innerHTML:_.value},null,8,ae),g.value?(t(),s("div",se,[n("p",re,[c(o(e.$t("Setup Key:"))+" ",1),n("span",{innerHTML:g.value},null,8,ne)])])):l("",!0),r.value?(t(),s("div",le,[i(U,{for:"code",value:e.$t("Code")},null,8,["value"]),i(z,{id:"code",modelValue:x(m).code,"onUpdate:modelValue":F[0]||(F[0]=w=>x(m).code=w),type:"text",name:"code",class:"mt-1 block w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:Q(C,["enter"])},null,8,["modelValue"]),i(O,{message:x(m).errors.code,class:"mt-2"},null,8,["message"])])):l("",!0)])):l("",!0),y.value.length>0&&!r.value?(t(),s("div",ie,[n("div",ce,[n("p",ue,o(e.$t("Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost.")),1)]),n("div",de,[(t(!0),s(Y,null,j(y.value,w=>(t(),s("div",{key:w},o(w),1))),128))])])):l("",!0)])):l("",!0),n("div",me,[f.value?(t(),s("div",ve,[i(p,{onConfirmed:C},{default:a(()=>[r.value?(t(),h(A,{key:0,type:"button",class:k(["me-3",{"opacity-25":u.value}]),disabled:u.value},{default:a(()=>[c(o(e.$t("Confirm")),1)]),_:1},8,["class","disabled"])):l("",!0)]),_:1}),i(p,{onConfirmed:L},{default:a(()=>[y.value.length>0&&!r.value?(t(),h($,{key:0,class:"me-3"},{default:a(()=>[c(o(e.$t("Regenerate Recovery Codes")),1)]),_:1})):l("",!0)]),_:1}),i(p,{onConfirmed:b},{default:a(()=>[y.value.length===0&&!r.value?(t(),h($,{key:0,class:"me-3"},{default:a(()=>[c(o(e.$t("Show Recovery Codes")),1)]),_:1})):l("",!0)]),_:1}),i(p,{onConfirmed:T},{default:a(()=>[r.value?(t(),h($,{key:0,class:k({"opacity-25":d.value}),disabled:d.value},{default:a(()=>[c(o(e.$t("Cancel")),1)]),_:1},8,["class","disabled"])):l("",!0)]),_:1}),i(p,{onConfirmed:T},{default:a(()=>[r.value?l("",!0):(t(),h(P,{key:0,class:k({"opacity-25":d.value}),disabled:d.value},{default:a(()=>[c(o(e.$t("Disable")),1)]),_:1},8,["class","disabled"]))]),_:1})])):(t(),s("div",fe,[i(p,{onConfirmed:V},{default:a(()=>[i(A,{type:"button",class:k({"opacity-25":u.value}),disabled:u.value},{default:a(()=>[c(o(e.$t("Enable")),1)]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{Ae as default};
